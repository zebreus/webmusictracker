#ifndef BASIC_INSTRUMENT_HPP
#define BASIC_INSTRUMENT_HPP

#include "imgui.h"
#include "imgui_internal.h"
#include <stdio.h>
#include <emscripten.h>
#include <string>
#include <vector>
#include <cmath>
#include <cstdlib>
#include <cstdio>
#include <iostream>
#include <filesystem>
#include "SampleLoader.hpp"
#include <AL/al.h>
#include <AL/alc.h>

using namespace std;


class BasicInstrument{
private:
    filesystem::path const * selectedSample = nullptr;
    vector<float> sampleData;
    vector<float> pitchedSampleData;
    SampleLoader * sampleManager = nullptr;
    
    ALCdevice *audioDevice;
    ALCcontext *audioContext;
    
    
public:
    BasicInstrument(SampleLoader* sampleManager);
    
    //Main functions
    void prepareInstrument(SampleLoader* sampleManager);
    void openAudioDevice(ALCdevice *audioDevice);
    void openAudioContext(ALCcontext *audioContext, ALCdevice *audioDevice);
    
    //Conditional functions
    bool check32BitExtension() const;
    bool checkAudioDeviceInitialized(ALCdevice *audioDevice) const;
    bool checkContextCurrent(ALCcontext *audioContext) const;

    void drawWindow();
    void playSample();
    //Pitches the sample up or down.
    // pitch 1 should be +1 octave
    void pitchSample(float pitch);
    //Stretches the sample by the given factor
    void stretchSample(float stretch);
    
};

#endif
